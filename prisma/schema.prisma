generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Student {
  id              String    @id @default(uuid())
  full_name       String
  faculty         String
  group           String
  email           String?   @unique
  phone           String?
  birth_date      DateTime
  enrollment_year Int
  status          Status    @default(active)
  profile_picture String?   // Profile picture URL/path
  deleted_at      DateTime? // Soft delete
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  created_by      String?   // Audit: who created
  updated_by      String?   // Audit: who updated
  auditLogs       AuditLog[]
  user            User?     // Student user account (for login)
}

model User {
  id              String    @id @default(uuid())
  student_id      String    @unique // Link to Student
  email           String    @unique
  password        String    // Hashed password (bcrypt)
  role            Role      @default(STUDENT)
  is_active       Boolean   @default(true)
  email_verified  Boolean   @default(false)
  last_login_at   DateTime?
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  
  student         Student   @relation(fields: [student_id], references: [id], onDelete: Cascade)
  
  @@index([email])
  @@index([student_id])
}

model Admin {
  id              String    @id @default(uuid())
  username        String    @unique
  email           String?   @unique
  password        String    // Hashed password (bcrypt)
  full_name       String?
  phone           String?
  role            AdminRole @default(ADMIN)
  is_active       Boolean   @default(true)
  last_login_at   DateTime?
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  
  @@index([username])
  @@index([role])
}

model AuditLog {
  id          String   @id @default(uuid())
  entity_type String   // e.g., "Student"
  entity_id   String   // ID of the entity
  action      String   // "CREATE", "UPDATE", "DELETE"
  user_id     String?  // Who performed the action
  changes     Json?    // What changed (JSON object)
  ip_address  String?
  user_agent  String?
  created_at  DateTime @default(now())
  
  student     Student? @relation(fields: [entity_id], references: [id], onDelete: Cascade)
}

enum Status {
  active
  graduated
  expelled
  academic_leave
}

enum Role {
  ADMIN
  STUDENT
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
}
